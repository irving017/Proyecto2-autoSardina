
<h2>Registra tu viaje!</h2>
<form action="/profile/route/new" method="POST">
<p>
Salida:
<input type="text" name="start[address]" id="start">
<input type="text" name="" id="lat" hidden="true">
Destino: 
<input type="text" name="destiny[address]" id="end">
<input type="text" name="" id="lng" hidden="true">
</p> 
<div id="map"></div>
  <p>
    Horario:
    <input type="time" name="time" id="horario">
  </p>
  <p>
    Asientos disponibles:
    <input min='1' max="3" type="number" name="seats" id="asientos">
  </p>
  <p>
    Tiempo de espera maximo(min):
    <input min='0' max="10" type="number" name="TE" id="TE">
  </p>
  <input type="submit"3 value="Registrar">
</form>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDIstIL_VA1Z_tPaYLKg2CvMG1sz6V0ywY&libraries=places"></script>
<script>
  let actual = {}
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(function(p){
      actual = {lat:p.coords.latitude, lng:p.coords.longitude}
    })
  }
  function initMap() {
    var directionsService = new google.maps.DirectionsService;
    var directionsDisplay = new google.maps.DirectionsRenderer;
    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 17,
      center: {lat: 19.39776549999999, lng: -99.1713954}
    });
    directionsDisplay.setMap(map);

    var onChangeHandler = function() {
      calculateAndDisplayRoute(directionsService, directionsDisplay);
    };
    document.getElementById('start').addEventListener('change', onChangeHandler);
    document.getElementById('end').addEventListener('change', onChangeHandler);
  }

  let start = document.getElementById('start')
  let end = document.getElementById('end')

  function calculateAndDisplayRoute(directionsService, directionsDisplay) {
    directionsService.route({
      origin: start.value,
      destination: end.value,
      travelMode: 'DRIVING'
    }, 
    function(response, status) {
      if (status === 'OK') {
      directionsDisplay.setDirections(response);
      } else {
      window.alert('Directions request failed due to ' + status);
      }
    });
  }
  function autoComplete(ainput){
    const dropdown = new google.maps.places.Autocomplete(ainput)
    dropdown.addListener('place_changed',()=>{
      const place = dropdown.getPlace()
    })
  }
  autoComplete(start)
  autoComplete(end)
  initMap()
</script>

